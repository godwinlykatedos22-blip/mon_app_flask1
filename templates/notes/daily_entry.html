{% extends "base.html" %}

{% block title %}Saisie Quotidienne des Notes{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4">üìù Saisie Quotidienne des Notes</h1>

    <!-- Formulaire de s√©lection -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="POST" action="{{ url_for('notes.daily_entry') }}" class="row g-3">
                {{ form.hidden_tag() }}

                <div class="col-md-3">
                    {{ form.class_id.label(class="form-label") }}
                    {{ form.class_id(class="form-select") }}
                    {% if form.class_id.errors %}
                        <div class="text-danger small">
                            {% for error in form.class_id.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <div class="col-md-3">
                    {{ form.subject.label(class="form-label") }}
                    {{ form.subject(class="form-control", placeholder="ex: Fran√ßais, Math√©matiques") }}
                    {% if form.subject.errors %}
                        <div class="text-danger small">
                            {% for error in form.subject.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <div class="col-md-2">
                    {{ form.assessment_type.label(class="form-label") }}
                    {{ form.assessment_type(class="form-select") }}
                    {% if form.assessment_type.errors %}
                        <div class="text-danger small">
                            {% for error in form.assessment_type.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <div class="col-md-2">
                    {{ form.term.label(class="form-label") }}
                    {{ form.term(class="form-select") }}
                    {% if form.term.errors %}
                        <div class="text-danger small">
                            {% for error in form.term.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <div class="col-md-2">
                    {{ form.date.label(class="form-label") }}
                    {{ form.date(class="form-control", type="date") }}
                    {% if form.date.errors %}
                        <div class="text-danger small">
                            {% for error in form.date.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <div class="col-md-2">
                    {{ form.max_score.label(class="form-label") }}
                    {{ form.max_score(class="form-control", placeholder="20.0") }}
                    {% if form.max_score.errors %}
                        <div class="text-danger small">
                            {% for error in form.max_score.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <div class="col-12">
                    {{ form.submit(class="btn btn-primary") }}
                    <a href="{{ url_for('notes.list_notes') }}" class="btn btn-secondary">Annuler</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Tableau de saisie des notes -->
    {% if submitted and students %}
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Saisie des notes - {{ form.subject.data }} (Classe: {{ form.class_id.data }})</h5>
        </div>
        <div class="card-body">
            <form method="POST" action="{{ url_for('notes.daily_entry') }}" class="needs-validation">
                {{ form.hidden_tag() }}
                
                <!-- Copier les donn√©es du formulaire initial dans les champs cach√©s -->
                <input type="hidden" name="class_id" value="{{ form.class_id.data }}">
                <input type="hidden" name="subject" value="{{ form.subject.data }}">
                <input type="hidden" name="assessment_type" value="{{ form.assessment_type.data }}">
                <input type="hidden" name="date" value="{{ form.date.data or '' }}">
                <input type="hidden" name="term" value="{{ form.term.data }}">
                <input type="hidden" name="max_score" value="{{ form.max_score.data }}">
                <input type="hidden" name="save_notes" value="1">

                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th class="col-8">üë§ √âl√®ve</th>
                                <th class="col-4">
                                    üìä Note / {{ form.max_score.data }}
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for student in students %}
                            <tr>
                                <td>
                                    <strong>{{ student.full_name }}</strong>
                                </td>
                                <td>
                                    <input 
                                        type="number" 
                                        step="0.01" 
                                        min="0" 
                                        max="{{ form.max_score.data }}"
                                        class="form-control form-control-sm" 
                                        name="score_{{ student.id }}"
                                        placeholder="Note"
                                        required
                                    >
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <div class="mt-3">
                    <button type="submit" class="btn btn-success btn-lg">
                        ‚úÖ Enregistrer {{ students|length }} note(s)
                    </button>
                    <a href="{{ url_for('notes.list_notes') }}" class="btn btn-secondary btn-lg">
                        ‚ùå Annuler
                    </a>
                </div>
            </form>
        </div>
    </div>
    {% endif %}

</div>

<style>
    .form-control-sm {
        font-size: 1rem;
        padding: 0.75rem 0.5rem;
    }
    
    .table-hover tbody tr:hover {
        background-color: #f5f5f5;
    }
</style>
{% endblock %}
