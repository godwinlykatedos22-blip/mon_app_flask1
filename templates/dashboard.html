{% extends "base.html" %}
{% block title %}Tableau de Bord{% endblock %}
{% block content %}
<div class="container-fluid py-4">
    <h1 class="mb-5">ğŸ“Š Tableau de Bord</h1>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="container mt-3">
          {% for category, message in messages %}
            <div class="alert alert-{{ 'success' if category=='success' else 'warning' if category=='warning' else 'danger' }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <div class="row">
        <!-- Ã‰lÃ¨ves Card -->
        <div class="col-md-6 col-lg-3 mb-4">
            <div class="card text-center shadow-sm border-0 h-100 transition">
                <div class="card-body d-flex flex-column">
                    <div style="font-size: 2.5rem; margin-bottom: 15px;">ğŸ‘¥</div>
                    <h5 class="card-title">Ã‰lÃ¨ves</h5>
                    <p class="card-text text-muted flex-grow-1">GÃ©rer la liste des Ã©lÃ¨ves et leurs informations.</p>
                    <a href="{{ url_for('eleves.list_eleves') }}" class="btn btn-outline-primary btn-sm mt-auto">
                        AccÃ©der
                    </a>
                </div>
            </div>
        </div>

        <!-- Notes Card -->
        <div class="col-md-6 col-lg-3 mb-4">
            <div class="card text-center shadow-sm border-0 h-100 transition">
                <div class="card-body d-flex flex-column">
                    <div style="font-size: 2.5rem; margin-bottom: 15px;">ğŸ“</div>
                    <h5 class="card-title">Notes</h5>
                    <p class="card-text text-muted flex-grow-1">Saisir, modifier et consulter les notes.</p>
                    <a href="{{ url_for('notes.list_notes') }}" class="btn btn-outline-primary btn-sm mt-auto">
                        AccÃ©der
                    </a>
                </div>
            </div>
        </div>

        <!-- Parents Card -->
        <div class="col-md-6 col-lg-3 mb-4">
            <div class="card text-center shadow-sm border-0 h-100 transition">
                <div class="card-body d-flex flex-column">
                    <div style="font-size: 2.5rem; margin-bottom: 15px;">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§</div>
                    <h5 class="card-title">Parents</h5>
                    <p class="card-text text-muted flex-grow-1">Suivi et contact avec les parents d'Ã©lÃ¨ves.</p>
                    <a href="{{ url_for('parents.list_parents') }}" class="btn btn-outline-primary btn-sm mt-auto">
                        AccÃ©der
                    </a>
                </div>
            </div>
        </div>

        <!-- WhatsApp Correspondence Card -->
        <div class="col-md-6 col-lg-3 mb-4">
            <div class="card text-center shadow-sm border-0 h-100 transition" style="border-left: 4px solid #25d366 !important;">
                <div class="card-body d-flex flex-column">
                    <div style="font-size: 2.5rem; margin-bottom: 15px;">ğŸ“±</div>
                    <h5 class="card-title">Correspondance</h5>
                    <p class="card-text text-muted flex-grow-1">Envoyer les notes aux parents via WhatsApp.</p>
                    <a href="{{ url_for('notes.correspondence') }}" class="btn btn-success btn-sm mt-auto">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: middle; margin-right: 4px;">
                            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.67-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.076 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421-7.403h-.004a9.87 9.87 0 00-5.031 1.378c-3.055 2.2-5.023 5.697-5.023 9.52 0 3.253.853 6.39 2.473 9.116l-2.633 9.608 9.897-2.522c2.752 1.508 5.848 2.296 9.048 2.296 10.391 0 18.842-8.45 18.842-18.844 0-5.034-1.995-9.766-5.627-13.32-3.633-3.553-8.457-5.51-13.58-5.51"/>
                        </svg>
                        AccÃ©der
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Section AnnÃ©e scolaire -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card border-info shadow">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">Choisir l'annÃ©e scolaire</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('admin.set_school_year') }}">
                        <select name="school_year" class="form-select form-select-lg mb-3">
                            <option value="2023-2024" {% if current_year == '2023-2024' %}selected{% endif %}>2023-2024</option>
                            <option value="2024-2025" {% if current_year == '2024-2025' %}selected{% endif %}>2024-2025</option>
                            <option value="2025-2026" {% if current_year == '2025-2026' %}selected{% endif %}>2025-2026</option>
                        </select>
                        <button type="submit" class="btn btn-primary">Valider</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card border-warning shadow">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">ClÃ´turer et ouvrir une nouvelle annÃ©e</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('admin.close_and_open_year') }}">
                        <p class="mb-3">ClÃ´turez l'annÃ©e scolaire en cours et ouvrez la suivante. Toutes les opÃ©rations seront archivÃ©es.</p>
                        <button type="submit" class="btn btn-danger" onclick="return confirm('ÃŠtes-vous sÃ»r de vouloir clÃ´turer l\'annÃ©e scolaire en cours et ouvrir la nouvelle ?');">ClÃ´turer et Ouvrir</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Stats Section -->
    <hr class="my-5">
    <div class="row mt-5">
        <div class="col-md-12">
            <h3 class="mb-4">ğŸ“Š Vue d'ensemble rapide</h3>
        </div>
        <div class="col-md-6 col-lg-3 mb-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <p class="text-muted mb-1">Total d'Ã©lÃ¨ves</p>
                            <h3 class="mb-0">{{ total_students }}</h3>
                        </div>
                        <div style="font-size: 2rem;">ğŸ‘¥</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3 mb-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <p class="text-muted mb-1">Nombre de classes</p>
                            <h3 class="mb-0">{{ classes|length }}</h3>
                        </div>
                        <div style="font-size: 2rem;">ğŸ«</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3 mb-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <p class="text-muted mb-1">AnnÃ©e scolaire</p>
                            <h3 class="mb-0">{{ current_year }}</h3>
                        </div>
                        <div style="font-size: 2rem;">ğŸ“…</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3 mb-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <p class="text-muted mb-1">Statut systÃ¨me</p>
                            <h3 class="mb-0 text-success">ğŸŸ¢ Actif</h3>
                        </div>
                        <div style="font-size: 2rem;">âš™ï¸</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .transition {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .transition:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15) !important;
    }

    .card {
        border-radius: 0.5rem;
    }
</style>
{% endblock %}

